import{_ as z,r,A as O,e as s,B as R,f as b,s as I,w as n,C,i as t,g as F,F as $,D as A,h as q,j as D,d as S,E as N,o as H,G as T,t as j}from"./index-dacd3bd5.js";const G=y=>{const c=new Map;y.forEach(a=>{const u=a._id.toString();c.set(u,{...a,children:[]})});const l=[];y.forEach(a=>{const u=a._id.toString();if(a.parentId){const p=a.parentId.toString(),i=c.get(p);i&&i.children.push(c.get(u))}else l.push(c.get(u))});const m=a=>{a.children.length===0?delete a.children:a.children.forEach(u=>m(u))};return l.forEach(a=>m(a)),l};const K={class:"dialog-footer"},Q={__name:"distributePermission",props:{modelValue:{type:Boolean,required:!0},roleId:{type:String,required:!0}},emits:["update:modelValue"],setup(y,{emit:c}){const l=r(!1),m=r("menus"),a=r([]),u=r([]),p=r([]),i=r([]),w=r(null),x=y,U=c,M=async()=>{const[f,d]=await S.roleOne(x.roleId),h=d.data.menus,V=d.data.resources;p.value=h.map(_=>_._id),i.value=V.map(_=>_._id)},k=async()=>{a.value=[],i.value=[],M(),l.value=!0;const[f,d]=await S.permissionList();l.value=!1;let h=d.data.menus;a.value=G(h),u.value=d.data.buttons},o={children:"children",label:"name"};O(()=>x.roleId,f=>{f&&k()});const g=async()=>{const f=w.value.getCheckedKeys();await S.rolePatch(x.roleId,{menus:f,resources:i.value}),N.success("用户角色更新成功"),v()},v=()=>{U("update:modelValue",!1)};return(f,d)=>{const h=s("el-tree"),V=s("el-tab-pane"),_=s("el-checkbox"),B=s("el-checkbox-group"),L=s("el-tabs"),E=s("el-button"),P=s("el-dialog"),Y=R("loading");return b(),I(P,{title:"配置角色权限","model-value":y.modelValue,width:"30%","align-center":"",draggable:"",onClose:v},{default:n(()=>[C((b(),I(L,{modelValue:m.value,"onUpdate:modelValue":d[1]||(d[1]=e=>m.value=e)},{default:n(()=>[t(V,{label:"配置菜单",name:"menus"},{default:n(()=>[t(h,{ref_key:"treeRef",ref:w,data:a.value,"show-checkbox":"","node-key":"_id",props:o,"default-checked-keys":p.value},null,8,["data","default-checked-keys"])]),_:1}),t(V,{label:"配置按钮",name:"buttons"},{default:n(()=>[t(B,{modelValue:i.value,"onUpdate:modelValue":d[0]||(d[0]=e=>i.value=e)},{default:n(()=>[(b(!0),F($,null,A(u.value,e=>(b(),I(_,{key:e._id,label:e.name,value:e._id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["modelValue"])),[[Y,l.value]]),q("div",K,[t(E,{onClick:v},{default:n(()=>[D("取消")]),_:1}),t(E,{type:"primary",onClick:g},{default:n(()=>[D("确认")]),_:1})])]),_:1},8,["model-value"])}}},J=z(Q,[["__scopeId","data-v-d534a614"]]);const W={class:"home-box"},X={__name:"roleList",setup(y){const c=r(!0);H(()=>{p()});const l=r({description:"",name:"",date:"",page:1,page_size:10}),m=r([]),a=r(0),u=r(!1),p=async()=>{u.value=!0;const[k,o]=await S.roleList(),g=o.data;m.value=g.roles,a.value=Number(g.page_info.total_items),u.value=!1},i=r(!1),w=r(""),x=k=>{w.value=k._id,i.value=!0},U=()=>{l.value.page=1,p()},M=()=>{N.error("演示模式")};return(k,o)=>{const g=s("el-input"),v=s("el-form-item"),f=s("el-date-picker"),d=s("el-button"),h=s("el-form"),V=s("right-toolbar"),_=s("el-table-column"),B=s("el-table"),L=s("pagination"),E=s("el-card"),P=R("auth"),Y=R("loading");return b(),F("div",W,[C(t(h,{inline:!0,model:l.value},{default:n(()=>[t(v,{value:"角色标识",prop:"name"},{default:n(()=>[t(g,{modelValue:l.value.name,"onUpdate:modelValue":o[0]||(o[0]=e=>l.value.name=e),placeholder:"角色标识：admin","controls-position":"right"},null,8,["modelValue"])]),_:1}),t(v,{value:"角色名称"},{default:n(()=>[t(g,{modelValue:l.value.description,"onUpdate:modelValue":o[1]||(o[1]=e=>l.value.description=e),placeholder:"角色名称",clearable:""},null,8,["modelValue"])]),_:1}),t(v,{value:"操作时间",style:{width:"308px"}},{default:n(()=>[t(f,{modelValue:l.value.date,"onUpdate:modelValue":o[2]||(o[2]=e=>l.value.date=e),"value-format":"YYYY-MM-DD",type:"daterange","range-separator":"-","start-placeholder":"开始日期","end-placeholder":"结束日期"},null,8,["modelValue"])]),_:1}),t(v,null,{default:n(()=>[C((b(),I(d,{onClick:U,type:"primary",style:{"margin-left":"-16px"}},{default:n(()=>[D("查询 ")]),_:1})),[[P,"/adminAuth/getRoleList"]])]),_:1})]),_:1},8,["model"]),[[T,c.value]]),t(V,{showSearch:c.value,"onUpdate:showSearch":o[3]||(o[3]=e=>c.value=e),onQueryTable:p,haveImport:!1,onOnOutClick:M,onOnAddClick:M},null,8,["showSearch"]),t(E,null,{default:n(()=>[C((b(),I(B,{data:m.value,"element-loading-text":"加载中...",border:""},{default:n(()=>[t(_,{prop:"name",label:"角色标识",width:"180"}),t(_,{prop:"description",label:"角色名称",width:"180"}),t(_,{label:"操作时间","min-width":"160"},{default:n(({row:e})=>[D(j(k.$filters.dateFilter(e.operator,"YYYY-MM-DD HH:mm:ss")),1)]),_:1}),t(_,{prop:"address",label:"操作","min-width":"160"},{default:n(({row:e})=>[t(d,{type:"primary",size:"small",onClick:Z=>x(e)},{default:n(()=>[D(" 配置权限 ")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[Y,u.value]]),C(t(L,{total:a.value,page:l.value.page,"onUpdate:page":o[4]||(o[4]=e=>l.value.page=e),limit:l.value.page_size,"onUpdate:limit":o[5]||(o[5]=e=>l.value.page_size=e),onPagination:p},null,8,["total","page","limit"]),[[T,a.value>0]])]),_:1}),t(J,{modelValue:i.value,"onUpdate:modelValue":o[6]||(o[6]=e=>i.value=e),roleId:w.value},null,8,["modelValue","roleId"])])}}},te=z(X,[["__scopeId","data-v-c82c8231"]]);export{te as default};
